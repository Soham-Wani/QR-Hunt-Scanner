<html>
<!-- https://console.firebase.google.com/project/qr-hunt-1/database/qr-hunt-1-default-rtdb/data/~2F -->
<!--
  1. Hide and retrieve system values in firebase (5 hours) [done]
  2. Update innerHTML javascript and pop up texts (4 hours)
  3. CSS (2 hour)
  4. Timed rounds (1 hour)
  5. Hide and retrieve QR values in firebase (5 hours) [done]
-->

<head>
  <title>QR Hunt Scanner</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@zxing/library@0.16.0/umd/index.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>
  <style>
    @import url("https://fonts.googleapis.com/css?family=Montserrat");

    * {
      font-family: "Montserrat", sans-serif;
    }

    body {
      background: #000000;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center center;
    }

    #previewcontainer {
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      position: fixed;
    }

    #preview {
      background: transparent;
      border: 5px solid transparent;
      border-radius: 20px;
      z-index: 1;
    }

    #iframecontainer {
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      position: fixed;
    }

    #iframe {
      background: transparent;
      border: 5px solid transparent;
      border-radius: 20px;
      z-index: 1;
      height: 80vh;
      width: 80vw;
    }

    #videocontainer {
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      position: fixed;
    }

    #video {
      background: transparent;
      border: 5px solid transparent;
      border-radius: 20px;
      z-index: 1;
      height: 80vh;
      width: 80vw;
    }

    #output {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      display: none;
      padding: 25px;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: white;
      background-color: rgba(255, 0, 0, 0.1);
      z-index: 2;
    }

    #thankyou {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: white;
      background-color: rgba(255, 0, 0, 0.1);
      z-index: 2;
    }

    a {
      background: transparent;
      border: 5px solid transparent;
      border-radius: 20px;
      z-index: 1;
      height: 80vh;
      width: 80vw;
      padding-top: 5px;
      color: white;
      font-weight: 900;
      font-size: 20px;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <h1 style='color:white'>QR Quest: The Crusade</h1>
  <div id="previewcontainer">
    <video id="preview"></video>
  </div>
  <div id="output"></div>
  <div id="thankyou">Thank you for playing</div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA1sy05k4XhbHYxCqL1UKN_AuGwAmnOA2A",
      authDomain: "qr-hunt-1.firebaseapp.com",
      databaseURL: "https://qr-hunt-1-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "qr-hunt-1",
      storageBucket: "qr-hunt-1.appspot.com",
      messagingSenderId: "809676584252",
      appId: "1:809676584252:web:fc9412bb864fe79a071a39"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.database().ref('Clues').child('round0').set({ // 12 (6 Glink)
      clue1: 'https://usualqueries.blogspot.com',
      clue2: 'c2',
      clue3: 'hi',
      clue4: 'hi',
      clue5: 'hi',
      clue6: 'hi'
    });
    firebase.database().ref('Clues').child('round1').set({ // 8 (4 Photo Clue)
      clue1: 'hi',
      clue2: 'hi',
      clue3: 'hi',
      clue4: 'hi'
    });
    firebase.database().ref('Clues').child('round2').set({ // 4 (2 video links)
      clue1: 'hi',
      clue2: 'hi'
    });
    firebase.database().ref('QRs').child('qrs').set({ // round 0
      r0q1: 'https://usualqueries.blogspot.com',
      r0q2: 'hii',
      r0q3: 'hiii',
      r0q4: 'hi',
      r0q5: 'hi',
      r0q6: 'hi',
      // round 1
      r1q1: 'https://usualqueries.blogspot.com',
      r1q2: 'hi',
      r1q3: 'hi',
      r1q4: 'hi',
      r1q5: 'hi',
      r1q6: 'hi',
      r1q7: 'hi',
      r1q8: 'hi',
      // round 2
      r2q1: 'https://usualqueries.blogspot.com',
      r2q2: 'hi',
      r2q3: 'hi',
      r2q4: 'hi',
      // round 3
      r3q1: 'hi',
      r3q2: 'hi',
      // round 4
      q1: '', q2: '', q3: '', q4: '', q5: '', q6: '', q7: '', q8: '', q9: '', q10: '', q11: '', q12: '', q13: '', q14: '', q15: '', q16: '', q17: '', q18: '', q19: '', q20: '', q21: '', q22: '', q23: '', q24: '', q25: '', q26: '', q27: '', q28: '', q29: '', q30: '', q31: '', q32: '', q33: '', q34: '', q35: '', q36: '', q37: '', q38: '', q39: '', q40: '', q41: '', q42: '', q43: '', q44: '', q45: '', q46: '', q47: '', q48: '', q49: '', q50: '', q51: ''
    });
    let scanTimer;
    const codeReader = new ZXing.BrowserQRCodeReader();
    function startScanTimer() {
      scanTimer = setTimeout(() => {
        location.reload();
      }, 300000);
    }
    function resetScanTimer() {
      clearTimeout(scanTimer);
      startScanTimer();
    }
    firebase.database().ref('QRs').child('qrs').once('value').then(function (snapshot) {
      const round0 = [snapshot.val().r0q1, snapshot.val().r0q2, snapshot.val().r0q3, snapshot.val().r0q4, snapshot.val().r0q5, snapshot.val().r0q6];
      const password = ['pass1', 'pass2', 'pass3', 'pass4', 'pass5', 'pass6', 'pass7', 'pass8', 'pass9', 'pass10', 'pass11', 'pass12'];
      const round1 = [snapshot.val().r1q1, snapshot.val().r1q2, snapshot.val().r1q3, snapshot.val().r1q4, snapshot.val().r1q5, snapshot.val().r1q6, snapshot.val().r1q7, snapshot.val().r1q8]; // 3 
      const round1teams = ['pass13', 'pass14'];
      const round1teamssplice = []; // 6 + 2
      const round2 = [snapshot.val().r2q1, snapshot.val().r2q2, snapshot.val().r2q3, snapshot.val().r2q4];
      const round2teams = []; // 4
      const round3 = [snapshot.val().r3q1, snapshot.val().r3q2];
      const round3teams = []; // 2
      const round4 = [snapshot.val().q1, snapshot.val().q2, snapshot.val().q3, snapshot.val().q4, snapshot.val().q5, snapshot.val().q6, snapshot.val().q7, snapshot.val().q8, snapshot.val().q9, snapshot.val().q10, snapshot.val().q11, snapshot.val().q12, snapshot.val().q13, snapshot.val().q14, snapshot.val().q15, snapshot.val().q16, snapshot.val().q17, snapshot.val().q18, snapshot.val().q19, snapshot.val().q20, snapshot.val().q21, snapshot.val().q22, snapshot.val().q23, snapshot.val().q24, snapshot.val().q25, snapshot.val().q26, snapshot.val().q27, snapshot.val().q28, snapshot.val().q29, snapshot.val().q30, snapshot.val().q31, snapshot.val().q32, snapshot.val().q33, snapshot.val().q34, snapshot.val().q35, snapshot.val().q36, snapshot.val().q37, snapshot.val().q38, snapshot.val().q39, snapshot.val().q40, snapshot.val().q41, snapshot.val().q42, snapshot.val().q43, snapshot.val().q44, snapshot.val().q45, snapshot.val().q46, snapshot.val().q47, snapshot.val().q48, snapshot.val().q49, snapshot.val().q50, snapshot.val().q51];
      const huntendtime = '2023-03-20T22:00:00+05:30';
      let clue;
      if (document.body.getBoundingClientRect().height > document.body.getBoundingClientRect().width) {
        document.getElementById('preview').style.maxHeight = '80vh';
        document.getElementById('preview').style.width = '80vw';
      } else if (document.body.getBoundingClientRect().height < document.body.getBoundingClientRect().width) {
        document.getElementById('preview').style.height = '80vh';
        document.getElementById('preview').style.maxWidth = '80vw';
      } else if (document.body.getBoundingClientRect().height = document.body.getBoundingClientRect().width) {
        document.getElementById('preview').style.height = '80vh';
        document.getElementById('preview').style.width = '80vw';
      }
      codeReader.getVideoInputDevices().then(videoInputDevices => {
        let deviceId = localStorage.getItem('defaultDeviceId');
        const rearCamera = videoInputDevices.find(device => {
          if (device.label.includes('back') || device.label.includes('rear')) {
            deviceId = device.deviceId;
            localStorage.setItem('defaultDeviceId', deviceId);
            return true;
          }
          return false;
        });
        if (!rearCamera) {
          deviceId = localStorage.getItem('defaultDeviceId') || videoInputDevices[0].deviceId;
          document.getElementById('preview').style.transform = 'scaleX(-1)';
        }
        codeReader.decodeFromInputVideoDevice(deviceId, 'preview')
          .then(result => {
            resetScanTimer();
            if (round0.includes(result.text) == true && new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) <= new Date(huntendtime)) {
              var database = firebase.database().ref('round0db');
              const userInput = prompt("Please enter your group passkey: ");
              const resulttosave = result.text;
              const index = round0.indexOf(resulttosave);
              const allowedindex1 = index * 2;
              const allowedindex2 = (index * 2) + 1;
              if (password.includes(userInput.toLowerCase())) {
                if (userInput.toLowerCase() == password[allowedindex1] || userInput.toLowerCase() == password[allowedindex2]) {
                  database.child(resulttosave).once('value').then(function (snapshot) {
                    database.child(resulttosave).set({
                      passkey: userInput.toLowerCase(),
                      time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                    });
                    firebase.database().ref('Clues').child('round1').once('value').then(function (snapshot) {
                      document.getElementById('preview').style.display = 'none';
                      switch (index) {
                        // 6 google maps links
                        case 0:
                          clue = snapshot.val().clue1;
                          break;
                        case 1:
                          clue = snapshot.val().clue2;
                          break;
                        case 2:
                          clue = snapshot.val().clue3;
                          break;
                        case 3:
                          clue = snapshot.val().clue4;
                          break;
                        case 4:
                          clue = snapshot.val().clue5;
                          break;
                        case 5:
                          clue = snapshot.val().clue6;
                          break;
                      }
                      document.getElementById('output').innerHTML = '<div id=\'iframecontainer\'><iframe id="iframe" src=\'' + clue + '\'></iframe></div><a id=\'link\' href=\'' + clue + '\'>Open in new tab</a>';
                      document.getElementById('output').style.display = 'flex';
                    });
                  });
                } else {
                  if (!window.alert("This isn\'t your QR. Put it back. \nIf you think this is a mistake, recheck passkey or contact staff.")) {
                    window.location.reload();
                  }
                }
              } else {
                if (!window.alert("Incorrect passkey. \nTry again or contact the staff if any issue persists.")) {
                  window.location.reload();
                }
              }
            } else if (round1.includes(result.text) == true && new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) <= new Date(huntendtime)) {
              var database = firebase.database().ref('round1db');
              const userInput = prompt("Please enter your group passkey: ");
              const resulttosave = result.text;
              const index = round1.indexOf(resulttosave);
              const allowedindex1 = index * 2;
              const allowedindex2 = (index * 2) + 1;
              if (password.includes(userInput.toLowerCase())) {
                if (userInput.toLowerCase() == password[allowedindex1] || userInput.toLowerCase() == password[allowedindex2]) {
                  database.child(resulttosave).once('value').then(function (snapshot) {
                    if (snapshot.exists()) {
                      var savedpasskey = snapshot.val().passkey;
                      if (savedpasskey === userInput.toLowerCase()) {
                        document.getElementById('preview').style.display = 'none';
                        firebase.database().ref('Clues').child('round0').once('value').then(function (snapshot) {
                          switch (index) {
                            // 6 Images (3 unique)
                            case 0:
                              clue = snapshot.val().clue1;
                              break;
                            case 1:
                              clue = snapshot.val().clue1;
                              break;
                            case 2:
                              clue = snapshot.val().clue2;
                              break;
                            case 3:
                              clue = snapshot.val().clue2;
                              break;
                            case 4:
                              clue = snapshot.val().clue3;
                              break;
                            case 5:
                              clue = snapshot.val().clue3;
                              break;
                            case 6:
                              clue = snapshot.val().clue4;
                              break;
                            case 7:
                              clue = snapshot.val().clue4;
                              break;
                          }
                          document.getElementById('output').innerHTML = '<div id=\'imagecontainer\'><img id="image" src=\'' + clue + '\' /></div><a id=\'link\' href=\'' + clue + '\'>Open in new tab</a>';
                          document.getElementById('output').style.display = 'flex';
                        });
                      } else {
                        alert("You are late. \nReport to staff. Your team has been eliminated.");
                        document.getElementById('preview').style.display = 'none';
                        document.getElementById('output').style.display = 'none';
                        document.getElementById('thankyou').style.display = 'flex';
                      }
                    } else {
                      database.child(resulttosave).set({
                        passkey: userInput.toLowerCase(),
                        time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                      });
                      document.getElementById('preview').style.display = 'none';
                      firebase.database().ref('Clues').child('round0').once('value').then(function (snapshot) {
                        switch (index) {
                          // 6 + 2 Images (3 + 1 unique)
                          case 0:
                            clue = snapshot.val().clue1;
                            break;
                          case 1:
                            clue = snapshot.val().clue1;
                            break;
                          case 2:
                            clue = snapshot.val().clue2;
                            break;
                          case 3:
                            clue = snapshot.val().clue2;
                            break;
                          case 4:
                            clue = snapshot.val().clue3;
                            break;
                          case 5:
                            clue = snapshot.val().clue3;
                            break;
                          case 6:
                            clue = snapshot.val().clue4;
                            break;
                          case 7:
                            clue = snapshot.val().clue4;
                            break;
                        }
                        document.getElementById('output').innerHTML = '<div id=\'imagecontainer\'><img id="image" src=\'' + clue + '\' /></div><a id=\'link\' href=\'' + clue + '\'>Open in new tab</a>';
                        document.getElementById('output').style.display = 'flex';
                      });
                    }
                  });
                } else {
                  if (!window.alert("This isn\'t your QR. Put it back. \nIf you think this is a mistake, recheck passkey or contact staff.")) {
                    window.location.reload();
                  }
                }
              } else {
                if (!window.alert("Incorrect passkey. \nTry again or contact the staff if any issue persists.")) {
                  window.location.reload();
                }
              }
            } else if (round2.includes(result.text) == true && new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) <= new Date(huntendtime)) {
              var database = firebase.database().ref('round2db');
              firebase.database().ref('round1db').once('value').then(snapshot => {
                try {
                  snapshot.forEach(childSnapshot => {
                    const round1pass = childSnapshot.child("passkey").val();
                    round1teamssplice.push(round1pass);
                  });
                  round1teams.splice(0, 0, ...round1teamssplice);
                  console.log(round1teams);
                  const userInput = prompt("Please enter your group passkey: ");
                  const resulttosave = result.text;
                  const index = round2.indexOf(resulttosave);
                  const allowedindex1 = index * 2;
                  const allowedindex2 = (index * 2) + 1;
                  if (round1teams.includes(userInput.toLowerCase())) {
                    if (userInput.toLowerCase() == round1teams[allowedindex1] || userInput.toLowerCase() == round1teams[allowedindex2]) {
                      database.child(resulttosave).once('value').then(function (snapshot) {
                        if (snapshot.exists()) {
                          var savedpasskey = snapshot.val().passkey;
                          if (savedpasskey === userInput.toLowerCase()) {
                            document.getElementById('preview').style.display = 'none';
                            firebase.database().ref('Clues').child('round0').once('value').then(function (snapshot) {
                              switch (index) {
                                case 0:
                                  clue = snapshot.val().clue1;
                                  break;
                                case 1:
                                  clue = snapshot.val().clue1;
                                  break;
                                case 2:
                                  clue = snapshot.val().clue2;
                                  break;
                                case 3:
                                  clue = snapshot.val().clue2;
                                  break;
                              }
                              document.getElementById('output').innerHTML = '<div id=\'videocontainer\'><video id="video" src=\'' + clue + '\' /></div><a id=\'link\' href=\'' + clue + '\'>Open in new tab</a>';
                              document.getElementById('output').style.display = 'flex';
                            });
                          } else {
                            alert("You are late. \nReport to staff. Your team has been eliminated.");
                            document.getElementById('preview').style.display = 'none';
                            document.getElementById('output').style.display = 'none';
                            document.getElementById('thankyou').style.display = 'flex';
                          }
                        } else {
                          database.child(resulttosave).set({
                            passkey: userInput.toLowerCase(),
                            time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                          });
                          document.getElementById('preview').style.display = 'none';
                          firebase.database().ref('Clues').child('round0').once('value').then(function (snapshot) {
                            switch (index) {
                              case 0:
                                clue = snapshot.val().clue1;
                                break;
                              case 1:
                                clue = snapshot.val().clue1;
                                break;
                              case 2:
                                clue = snapshot.val().clue2;
                                break;
                              case 3:
                                clue = snapshot.val().clue2;
                                break;
                            }
                            document.getElementById('output').innerHTML = '<div id=\'videocontainer\'><video id="video" src=\'' + clue + '\' /></div><a id=\'link\' href=\'' + clue + '\'>Open in new tab</a>';
                            document.getElementById('output').style.display = 'flex';
                          });
                        }
                      });
                    } else {
                      if (!window.alert("This isn\'t your QR. Put it back. \nIf you think this is a mistake, recheck passkey or contact staff.")) {
                        window.location.reload();
                      }
                    }
                  } else if (round1teams.includes(userInput.toLowerCase()) == false && password.includes(userInput.toLowerCase()) == true) {
                    if (!window.alert("Incorrect passkey. \nYour team has been eliminated.")) {
                      window.location.reload();
                    }
                  } else {
                    if (!window.alert("Incorrect passkey. \nTry again or contact the staff if any issue persists.")) {
                      window.location.reload();
                    }
                  }
                } catch (error) {
                  console.error('Error retrieving data from Firebase: ', error);
                }
              });
            } else if (round3.includes(result.text) == true && new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) <= new Date(huntendtime)) {
              var database = firebase.database().ref('round3db');
              firebase.database().ref('round2db').once('value').then(snapshot => {
                try {
                  snapshot.forEach(childSnapshot => {
                    const round2pass = childSnapshot.child("passkey").val();
                    round2teams.push(round2pass);
                  });
                  console.log(round2teams);
                  const userInput = prompt("Please enter your group passkey: ");
                  const resulttosave = result.text;
                  const index = round3.indexOf(resulttosave);
                  const allowedindex1 = index * 2;
                  const allowedindex2 = (index * 2) + 1;
                  if (round2teams.includes(userInput.toLowerCase())) {
                    if (userInput.toLowerCase() == round2teams[allowedindex1] || userInput.toLowerCase() == round2teams[allowedindex2]) {
                      database.child(resulttosave).once('value').then(function (snapshot) {
                        if (snapshot.exists()) {
                          var savedpasskey = snapshot.val().passkey;
                          if (savedpasskey === userInput.toLowerCase()) {
                            document.getElementById('preview').style.display = 'none';
                            switch (index) {
                              case 0:
                                document.getElementById('output').innerHTML = '<h2>Congratulations!<br>You are in the finals</h2>';
                                break;
                              case 1:
                                document.getElementById('output').innerHTML = '<h2>Congratulations!<br>You are in the finals</h2>';
                                break;
                            }
                            document.getElementById('output').style.display = 'flex';
                          } else {
                            alert("You are late. \nReport to staff. Your team has been eliminated.");
                            document.getElementById('preview').style.display = 'none';
                            document.getElementById('output').style.display = 'none';
                            document.getElementById('thankyou').style.display = 'flex';
                          }
                        } else {
                          database.child(resulttosave).set({
                            passkey: userInput.toLowerCase(),
                            time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                          });
                          document.getElementById('preview').style.display = 'none';
                          switch (index) {
                            case 0:
                              document.getElementById('output').innerHTML = '<h2>Congratulations!<br>You are in the finals</h2>';
                              break;
                            case 1:
                              document.getElementById('output').innerHTML = '<h2>Congratulations!<br>You are in the finals</h2>';
                              break;
                          }
                          document.getElementById('output').style.display = 'flex';
                        }
                      });
                    } else {
                      if (!window.alert("This isn\'t your QR. Put it back. \nIf you think this is a mistake, recheck passkey or contact staff.")) {
                        window.location.reload();
                      }
                    }
                  } else if (round1teams.includes(userInput.toLowerCase()) == false && password.includes(userInput.toLowerCase()) == true) {
                    if (!window.alert("Incorrect passkey. \nYour team has been eliminated.")) {
                      window.location.reload();
                    }
                  } else {
                    if (!window.alert("Incorrect passkey. \nTry again or contact the staff if any issue persists.")) {
                      window.location.reload();
                    }
                  }
                } catch (error) {
                  console.error('Error retrieving data from Firebase: ', error);
                }
              });
            } else if (round4.includes(result.text) == true && new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) <= new Date(huntendtime)) {
              var database = firebase.database().ref('round4db');
              const scannedpoints = parseInt(result.text.match(/\d+/g).join(''));
              firebase.database().ref('round3db').once('value').then(snapshot => {
                try {
                  snapshot.forEach(childSnapshot => {
                    const round2pass = childSnapshot.child("passkey").val();
                    round3teams.push(round2pass);
                  });
                  console.log(round3teams);
                  const userInput = prompt("Please enter your group passkey: ");
                  const resulttosave = result.text;
                  const index = round4.indexOf(resulttosave);
                  if (round3teams.includes(userInput.toLowerCase())) {
                    if (userInput.toLowerCase() == round3teams[0] || userInput.toLowerCase() == round3teams[1]) {
                      database.child(resulttosave).once('value').then(function (snapshot) {
                        if (snapshot.exists()) {
                          if (!window.alert("This QR is already scanned.")) {
                            window.location.reload();
                          }
                        } else {
                          database.child(userInput.toLowerCase()).once('value').then(function (snapshot) {
                            if (snapshot.val() !== null) {
                              const oldpoints = snapshot.val().points;
                              const totalpoints = oldpoints + scannedpoints;
                              database.child(userInput.toLowerCase()).set({
                                points: totalpoints
                              });
                              database.child(resulttosave).set({
                                passkey: userInput.toLowerCase(),
                                time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                              });
                            } else {
                              const oldpoints = 0;
                              const totalpoints = oldpoints + scannedpoints;
                              database.child(userInput.toLowerCase()).set({
                                points: totalpoints
                              });
                              database.child(resulttosave).set({
                                passkey: userInput.toLowerCase(),
                                time: (new Date()).toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })
                              });
                            }
                            document.getElementById('preview').style.display = 'none';
                            document.getElementById('output').innerHTML = 'Your team just scanned and recieved ' + scannedpoints + ' points.';
                            document.getElementById('output').style.display = 'flex';
                          });
                        }
                      });
                    } else {
                      if (!window.alert("This isn\'t your QR. Put it back. \nIf you think this is a mistake, recheck passkey or contact staff.")) {
                        window.location.reload();
                      }
                    }
                  } else if (round1teams.includes(userInput.toLowerCase()) == false && password.includes(userInput.toLowerCase()) == true) {
                    if (!window.alert("Incorrect passkey. \nYour team has been eliminated.")) {
                      window.location.reload();
                    }
                  } else {
                    if (!window.alert("Incorrect passkey. \nTry again or contact the staff if any issue persists.")) {
                      window.location.reload();
                    }
                  }
                } catch (error) {
                  console.error('Error retrieving data from Firebase: ', error);
                }
              });
            } else if (new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })) >= new Date(huntendtime)) {
              if (!window.alert("This QR hunt has been ended.")) {
                window.location.reload();
              }
            } else {
              if (!window.alert("Detected QR is not a part of this QR hunt.")) {
                window.location.reload();
              }
            }
          })
          .catch(err => {
            console.error(err);
            if (err.message == "Permission denied" || err.message == "Permission dismissed") {
              if (!window.alert('Missing the permission to use camera. Can\'t proceed further.')) {
                window.location.reload();
              }
            } else {
              window.alert('This is an unanticipated error. Please report to staff. \n' + err.message + '.');
            }
            resetScanTimer();
          });
        startScanTimer();
      });
    });
  </script>

</body>

</html>
